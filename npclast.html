<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NPC Last - 05/29/25</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #222;
      color: #fff;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1em;
    }
    th, td {
      padding: 8px;
      border: 1px solid #555;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #fff;
      color: #000;
      padding: 20px;
      width: 80%;
    }
    .close {
      float: right;
      cursor: pointer;
      font-size: 1.5em;
    }
    .higher {
      background-color: green;
      color: white;
    }
    .lower {
      background-color: red;
      color: white;
    }
  </style>
</head>
<body>

<h1>NPC List</h1>
<table id="npcTable">
  <thead>
    <tr>
      <th>Select</th>
      <th>Name</th>
      <th>Description</th>
      <th>Stats</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div id="comparisonModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h2>NPC Comparison</h2>
    <table id="comparisonTable">
      <thead>
        <tr><th>Attribute</th><th>NPC 1</th><th>NPC 2</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
let selectedNPCs = [];

async function loadNPCs() {
  const response = await fetch('npc.json');
  const npcs = await response.json();
  const tbody = document.querySelector("#npcTable tbody");

  npcs.forEach(npc => {
    const row = document.createElement('tr');

    const sel = document.createElement('td');
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.onclick = () => handleSelection(npc, checkbox);
    sel.appendChild(checkbox);
    row.appendChild(sel);

    const name = document.createElement('td');
    name.textContent = npc.name;
    row.appendChild(name);

    const desc = document.createElement('td');
    desc.textContent = npc.desc || 'No description';
    row.appendChild(desc);

    const stats = document.createElement('td');
    stats.textContent = npc.stats ? JSON.stringify(npc.stats, null, 2) : 'No stats';
    row.appendChild(stats);

    tbody.appendChild(row);
  });
}

function handleSelection(npc, checkbox) {
  if (checkbox.checked) {
    selectedNPCs.push(npc);
  } else {
    selectedNPCs = selectedNPCs.filter(n => n !== npc);
  }

  if (selectedNPCs.length === 2) {
    showComparison(selectedNPCs[0], selectedNPCs[1]);
  }
}

function showComparison(npc1, npc2) {
  const table = document.querySelector('#comparisonTable tbody');
  table.innerHTML = '';
  const stats1 = npc1.stats || {};
  const stats2 = npc2.stats || {};
  const allKeys = new Set([...Object.keys(stats1), ...Object.keys(stats2)]);

  allKeys.forEach(key => {
    const row = document.createElement('tr');
    const cellKey = document.createElement('td');
    cellKey.textContent = key;

    const val1 = stats1[key] ?? '—';
    const val2 = stats2[key] ?? '—';

    const cell1 = document.createElement('td');
    const cell2 = document.createElement('td');

    cell1.textContent = val1;
    cell2.textContent = val2;

    if (!isNaN(val1) && !isNaN(val2)) {
      if (parseFloat(val1) > parseFloat(val2)) {
        cell1.classList.add('higher');
        cell2.classList.add('lower');
      } else if (parseFloat(val1) < parseFloat(val2)) {
        cell1.classList.add('lower');
        cell2.classList.add('higher');
      }
    }

    row.appendChild(cellKey);
    row.appendChild(cell1);
    row.appendChild(cell2);
    table.appendChild(row);
  });

  document.getElementById('comparisonModal').style.display = 'flex';
}

function closeModal() {
  document.getElementById('comparisonModal').style.display = 'none';
}

document.addEventListener('DOMContentLoaded', loadNPCs);
</script>

</body>
</html>
